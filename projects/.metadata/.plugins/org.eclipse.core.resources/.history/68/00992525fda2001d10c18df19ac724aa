#include "STD_TYPES.h"
#include <util/delay.h>

#include "DIO_interface.h"
#include "PORT_interface.h"
#include "TIMER_interface.h"
#include "GIE_interface.h"
#include "USART_interface.h"

#include "CLCD_interface.h"
#include "ULTSONC_interface.h"


void Bluetooth(void);

static u8 BLTH_MotionFlag = 0;
void main(void)
{
	PORT_voidInit();
	CLCD_voidInit();

	USRAT_voidInit();

	USART_u8ReceiverInterruptControl(RX_INT_ENABLE);
	USART_voidSetRxCallBackFunc(&Bluetooth);
	GIE_voidEnable();

	u8 Local_u8Bluetooth;


	while(1)
	{

		if((ULTSONC_u16ObstacleDetection() == 0) && (BLTH_MotionFlag == 1))
		{
			DIO_u8SetPinValue(DIO_u8PORTA,DIO_u8PIN0,DIO_u8PIN_HIGH);
//			USART_voidSendString("Start");
		}
		else
		{
			DIO_u8SetPinValue(DIO_u8PORTA,DIO_u8PIN0,DIO_u8PIN_LOW);

//			USART_voidSendString("Stop");
		}
	}
}

void Bluetooth(void)
{
	u8 Local_u8Reading;
	Local_u8Reading = USART_u8Receive_Int();

	if(Local_u8Reading == '2')
	{
		BLTH_MotionFlag = 0;
	}

	else if(Local_u8Reading == '1')
	{
		BLTH_MotionFlag = 1;

	}
}
