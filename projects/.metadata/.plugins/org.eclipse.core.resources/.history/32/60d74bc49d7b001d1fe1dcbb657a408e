/***********************************************************************/
/***********************************************************************/
/************************ AUTHER : Hanin Anwar  ************************/
/************************ LAYER  : RTOS_Stack         ************************/
/************************ SWC    : RTOS          ************************/
/************************ VERSION : 1.00         ************************/
/***********************************************************************/
/***********************************************************************/

#include "STD_TYPES.h"

#include "TIMER_interface.h"
#include "GIE_interface.h"

#include "RTOS_config.h"
#include "RTOS_interface.h"
#include "RTOS_private.h"

static Task_t SystemTasks[TASK_NUM] = {{NULL}};

void RTOS_voidStart(void)
{
	TIMER_u8SetCallBack(TIMER0_OUTPUT_COM_INT,&voidScheduler);
	GIE_voidEnable();
	TIMER0_u8Init(CTC,DISCONNECT,TIMER_DIV_BY_64);
	TIMER0_voidSetCompMatchVal(125);

}
void RTOS_voidCreatTask(u8 Copy_u8Priority, u16 Copy_u8Periodicity, void (*Copy_pvoidTaskFunc)(void))
{
	SystemTasks[Copy_u8Priority].Periodicity = Copy_u8Periodicity;
	SystemTasks[Copy_u8Priority].TaskFunc = Copy_pvoidTaskFunc;

}


static void voidScheduler(void)
{
	static u16 Local_u16TickCounter = 0;
	u8 Local_u8TaskCounter;

	/*Loop on each to check on their periodicity*/

	for(Local_u8TaskCounter = 0;Local_u8TaskCounter < TASK_NUM ; Local_u8TaskCounter++)
	{
		if((Local_u16TickCounter % SystemTasks[Local_u8TaskCounter].Periodicity) == 0)
		{
			/*Invoke the task function*/
			if(SystemTasks[Local_u8TaskCounter].TaskFunc != NULL)
			{
				SystemTasks[Local_u8TaskCounter].TaskFunc();
			}
		}
	}
	Local_u16TickCounter++;
}


void RTOS_voidSuspendTask(u8 Copy_u8Priority)
{

}

void RTOS_voidResumeTask(u8 Copy_u8Priority)
{

}
